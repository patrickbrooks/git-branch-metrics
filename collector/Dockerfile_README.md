# Running git-branch-metrics-collector via cron in a Docker container

1. Confirm Docker is installed and running
```
docker version
```

1. Build the Docker image. Note that 'gbmc' stands for 'git-branch-metrics-collector'
```
docker images
docker build -t gbmc .
docker images
```

1. Create a persistent Docker volume to hold cloned repos
```
docker volume ls
docker volume create gbmc_repos
docker volume ls
docker volume inspect gbmc_repos
```

1. Start a container from the image. This container runs a cron job that executes git-branch-metrics-collector.py and stores cloned repositories in the gbmc_repos docker volume
```
docker run -d --mount src=gbmc_repos,dst=/root/repos gbmc
```

1. If desired, watch the logs generated by the cron job
```
docker ps
docker logs -f <containerId of gbmc process>
<Ctrl-c to exit>
```

## During Development

For development, follow instructions in the Dockerfile to disable cron and enable bash. Then, run the image with the -it flags (instead of -d), and mount the user's git repo directory inside the container's /root/dev directory:
```
docker run -it \
--mount type=bind,source='/Users/pb/Git/git-branch-metrics',target='/root/dev' \
--mount src=gbmc_repos,dst=/root/repos \
gbmc
```

Inside the container, run the script manually
```
cd /root/dev/collector
./git-branch-metrics-collector.py
```

Outside the container, edit and save changes to git-branch-metrics-collector.py. Then, inside the container, re-run the script to see the new behavior.

Lather, rinse, repeat.
